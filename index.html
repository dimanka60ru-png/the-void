<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE VOID TEMPLE | $CLICK</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { 
            --bg-val: 255; 
            --text-col: #1a1a1a;
            --accent: #ff3b30;
            --lid-pos: -100%;
            --mouth-curve: 0px; /* Изгиб рта */
            --grain-op: 0.04;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: rgb(var(--bg-val), var(--bg-val), var(--bg-val));
            color: var(--text-col);
            font-family: 'Inter', sans-serif;
            height: 100vh; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            transition: background 0.5s linear, color 1s ease;
            overflow: hidden; text-align: center;
        }

        /* Эффект зернистости */
        body::after { 
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: url(https://upload.wikimedia.org);
            opacity: var(--grain-op); pointer-events: none; z-index: 100;
        }

        /* ОГРОМНАЯ ОБЪЕМНАЯ КНОПКА */
        #btn { 
            width: 200px; height: 200px; 
            background: radial-gradient(circle at 35% 35%, #ff5248, #d32f2f);
            border-radius: 50%; border: none; cursor: pointer; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            box-shadow: 0 25px 60px rgba(211, 47, 47, 0.4), inset 0 -12px 20px rgba(0,0,0,0.3); 
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            z-index: 50; position: relative;
        }
        #btn:active { transform: scale(0.92); box-shadow: 0 10px 30px rgba(211, 47, 47, 0.5); }

        /* ЛИЦО */
        .eyes-row { display: flex; gap: 25px; margin-bottom: 15px; }
        .eye { width: 36px; height: 22px; background: #fff; border-radius: 50%; position: relative; overflow: hidden; border: 1px solid rgba(0,0,0,0.1); }
        .p { width: 14px; height: 14px; background: #000; border-radius: 50%; position: absolute; top: 4px; left: 11px; transition: transform 0.05s linear; }
        .lid { position: absolute; top: var(--lid-pos); left: 0; width: 100%; height: 100%; background: #d32f2f; transition: 0.1s ease; z-index: 2; }

        /* РОТ - ЭВОЛЮЦИЯ ГРУСТИ */
        .mouth-container { width: 40px; height: 20px; position: relative; overflow: hidden; }
        #mouth-svg { width: 40px; height: 20px; fill: none; stroke: rgba(0,0,0,0.7); stroke-width: 2.5; stroke-linecap: round; transition: 0.3s ease; }

        /* ИНТЕРФЕЙС */
        #q { font-family: 'Playfair Display', serif; font-size: 1.6rem; margin-bottom: 60px; min-height: 90px; width: 85%; max-width: 700px; z-index: 10; }
        #in { position: absolute; bottom: 140px; background: none; border: none; border-bottom: 1px solid rgba(128,128,128,0.3); color: inherit; text-align: center; width: 240px; padding: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; z-index: 60; }
        
        .ft { position: absolute; bottom: 25px; font-size: 0.7rem; font-family: 'JetBrains Mono', monospace; opacity: 0.6; z-index: 10; width: 100%; }
        #ca { border: 1px solid rgba(128,128,128,0.4); padding: 8px 18px; border-radius: 25px; cursor: pointer; display: inline-block; margin-top: 15px; transition: 0.3s; }
        #ca:hover { background: var(--text-col); color: var(--bg-hue); }

        .langs { position: absolute; top: 30px; display: flex; gap: 15px; z-index: 10; }
        .l-btn { font-size: 0.65rem; cursor: pointer; opacity: 0.4; letter-spacing: 1px; font-family: 'JetBrains Mono', monospace; }
        .l-btn.active { opacity: 1; color: var(--accent); font-weight: bold; }

        #chat-wall { position: absolute; top: 15%; width: 100%; pointer-events: none; height: 200px; z-index: 5; }
        .m { font-family: 'Playfair Display', serif; font-style: italic; font-size: 1.3rem; animation: floatMsg 6s forwards; text-align: center; position: absolute; left: 0; right: 0; }
        @keyframes floatMsg { 0% { opacity: 0; transform: translateY(20px); } 15% { opacity: 0.8; } 100% { opacity: 0; transform: translateY(-50px); } }
    </style>
</head>
<body>

    <div class="langs">
        <div class="l-btn active" onclick="setL('en')">EN</div>
        <div class="l-btn" onclick="setL('ru')">RU</div>
    </div>

    <div id="chat-wall"></div>

    <div id="q">Look into the void. It is looking back.</div>

    <button id="btn">
        <div class="eyes-row">
            <div class="eye"><div class="lid"></div><div class="p"></div></div>
            <div class="eye"><div class="lid"></div><div class="p"></div></div>
        </div>
        <div class="mouth-container">
            <svg id="mouth-svg" viewBox="0 0 40 20">
                <path id="mouth-path" d="M 5 10 Q 20 10 35 10" />
            </svg>
        </div>
    </button>

    <input type="text" id="in" placeholder="whisper to the void..." maxlength="50">

    <div class="ft">
        <div id="cnt">personal despair: 0 clicks</div>
        <div id="ca" onclick="copyCA()">CA: CZkrVESiJHyjtR39m7a5doaZwSFT5YMpy8pJMretpump</div>
    </div>

<script src="https://cdn.pubnub.com"></script>
<script>
    const CA_ADDR = "CZkrVESiJHyjtR39m7a5doaZwSFT5YMpy8pJMretpump";
    let clicks = parseInt(localStorage.getItem('v_final_v3')) || 0;
    let currentLang = 'en';
    let aCtx;

    // --- ЧАТ ---
    const pn = new PubNub({ publishKey: 'demo', subscribeKey: 'demo', uuid: 'v' + Math.random() });
    pn.addListener({ message: (m) => {
        const d = document.createElement('div'); d.className = 'm'; d.innerText = m.message;
        document.getElementById('chat-wall').appendChild(d); setTimeout(() => d.remove(), 5800);
    }});
    pn.subscribe({ channels: ['void_v3_chat'] });

    document.getElementById('in').onkeypress = (e) => {
        if(e.key === 'Enter' && e.target.value.trim() !== '') {
            pn.publish({ channel: 'void_v3_chat', message: e.target.value }); e.target.value = '';
        }
    };

    // --- ЗВУК ---
    function initA() {
        if (!aCtx) aCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (aCtx.state === 'suspended') aCtx.resume();
    }
    function play() {
        if (!aCtx) return;
        const o = aCtx.createOscillator(); const g = aCtx.createGain();
        o.type = 'triangle'; o.frequency.setValueAtTime(1000, aCtx.currentTime);
        o.frequency.exponentialRampToValueAtTime(150, aCtx.currentTime + 0.1);
        g.gain.setValueAtTime(0.5, aCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, aCtx.currentTime + 0.1);
        o.connect(g); g.connect(aCtx.destination); o.start(); o.stop(aCtx.currentTime + 0.1);
    }

    // --- ЭВОЛЮЦИЯ ---
    function updateEvolution() {
        const root = document.documentElement;
        const progress = Math.min(clicks / 1000, 1);
        
        // Постепенное потемнение (255 -> 15)
        const colorVal = Math.floor(255 - (progress * 240));
        root.style.setProperty('--bg-val', colorVal);
        
        // Текст: меняем на белый, когда совсем темно
        if (colorVal < 100) root.style.setProperty('--text-col', '#eee');
        else root.style.setProperty('--text-col', '#1a1a1a');

        // Зернистость: растет к финалу
        root.style.setProperty('--grain-op', 0.04 + (progress * 0.1));

        // РОТ: изгибаем кривую Безье (Q 20 10 -> Q 20 25)
        const mouthY = 10 + (progress * 15);
        document.getElementById('mouth-path').setAttribute('d', `M 5 10 Q 20 ${mouthY} 35 10`);
        
        const langText = currentLang === 'ru' ? 'твоя боль: ' : 'personal despair: ';
        document.getElementById('cnt').innerText = langText + clicks + (currentLang === 'ru' ? ' кликов' : ' clicks');
    }

    const b = document.getElementById('btn');
    b.onmousedown = () => { 
        initA(); 
        document.documentElement.style.setProperty('--lid-pos', '0%'); 
        play(); 
    };
    b.onmouseup = () => {
        if (clicks < 1000) clicks++; 
        localStorage.setItem('v_final_v3', clicks);
        document.documentElement.style.setProperty('--lid-pos', '-100%'); 
        updateEvolution();
    };

    document.addEventListener('mousemove', (e) => {
        document.querySelectorAll('.p').forEach(p => {
            const r = p.getBoundingClientRect();
            const ang = Math.atan2(e.clientX - (r.left + r.width/2), e.clientY - (r.top + r.height/2));
            p.style.transform = `rotate(${(ang * (180/Math.PI) * -1) + 180}deg) translateY(-6px)`;
        });
    });

    function setL(l) { 
        currentLang = l; 
        document.querySelectorAll('.l-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase() === l));
        updateEvolution(); 
    }
    function copyCA() { 
        navigator.clipboard.writeText(CA_ADDR); 
        const el = document.getElementById('ca'); el.innerText = "COPIED"; 
        setTimeout(() => el.innerText = "CA: " + CA_ADDR.substring(0,6) + "...", 1000); 
    }

    updateEvolution();
</script>
</body>
</html>
