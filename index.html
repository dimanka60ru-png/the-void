<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE VOID TEMPLE | $CLICK</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { 
            --bg-hue: 255; /* Белый */
            --text-color: #1a1a1a;
            --accent: #ff3b30;
            --eye-state: -100%;
            --sadness: 0deg;
            --grayscale: 0%;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: rgb(var(--bg-hue), var(--bg-hue), var(--bg-hue));
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            height: 100vh; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            transition: background 0.8s ease, color 0.8s ease; /* Очень плавная смена */
            overflow: hidden; text-align: center;
            filter: grayscale(var(--grayscale));
        }

        body::after { 
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: url(https://upload.wikimedia.org);
            opacity: 0.05; pointer-events: none; 
        }

        /* КНОПКА С ОБЪЕМОМ */
        #btn { 
            width: 170px; height: 170px; 
            background: radial-gradient(circle at 30% 30%, #ff5f56, #cc2f26);
            border-radius: 50%; border: none; cursor: pointer; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            box-shadow: 0 20px 60px rgba(255,0,0,0.2), inset 0 -10px 20px rgba(0,0,0,0.3); 
            transition: transform 0.1s; z-index: 10;
        }
        #btn:active { transform: scale(0.94); }

        /* ЛИЦО */
        .eyes-row { display: flex; gap: 20px; margin-bottom: 12px; }
        .eye { width: 32px; height: 20px; background: #fff; border-radius: 50%; position: relative; overflow: hidden; border: 1px solid rgba(0,0,0,0.1); }
        .p { width: 13px; height: 13px; background: #000; border-radius: 50%; position: absolute; top: 3px; left: 9px; transition: transform 0.05s linear; }
        .lid { position: absolute; top: var(--eye-state); left: 0; width: 100%; height: 100%; background: #cc2f26; transition: 0.1s; z-index: 2; }

        #mouth {
            width: 35px; height: 15px;
            border: 2px solid rgba(0,0,0,0.6);
            border-top: transparent; border-left: transparent; border-right: transparent;
            border-radius: 50%;
            transform: rotateX(var(--sadness));
            transition: 0.3s ease;
        }

        /* ИНТЕРФЕЙС */
        #q { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-bottom: 50px; min-height: 80px; width: 80%; }
        #in { position: absolute; bottom: 130px; background: none; border: none; border-bottom: 1px solid #999; color: inherit; text-align: center; width: 220px; padding: 5px; font-size: 0.8rem; }
        .ft { position: absolute; bottom: 20px; font-size: 0.7rem; opacity: 0.6; }
        #ca { border: 1px solid #999; padding: 6px 15px; border-radius: 20px; cursor: pointer; display: inline-block; margin-top: 10px; font-family: monospace; }
        
        .langs { position: absolute; top: 20px; display: flex; gap: 10px; }
        .l-btn { font-size: 0.6rem; cursor: pointer; opacity: 0.5; text-transform: uppercase; }
        .l-btn.active { opacity: 1; font-weight: bold; color: var(--accent); }

        #chat-wall { position: absolute; top: 15%; width: 100%; pointer-events: none; height: 150px; overflow: hidden; }
        .m { font-family: 'Playfair Display', serif; font-style: italic; font-size: 1.2rem; animation: f 6s forwards; text-align: center; }
        @keyframes f { 0% { opacity: 0; transform: translateY(10px); } 15% { opacity: 0.8; } 100% { opacity: 0; transform: translateY(-40px); } }
    </style>
</head>
<body>

    <div class="langs"><div class="l-btn active">EN</div><div class="l-btn">RU</div></div>
    <div id="chat-wall"></div>

    <div id="q">Прими пустоту.</div>

    <button id="btn">
        <div class="eyes-row">
            <div class="eye"><div class="lid"></div><div class="p"></div></div>
            <div class="eye"><div class="lid"></div><div class="p"></div></div>
        </div>
        <div id="mouth"></div>
    </button>

    <input type="text" id="in" placeholder="прошепчи что-нибудь..." maxlength="50">

    <div class="ft">
        <div id="cnt">твоя боль: 0</div>
        <div id="ca" onclick="cp()">CA: CZkrVESiJHyjtR39m7a5doaZwSFT5YMpy8pJMretpump</div>
    </div>

<script src="https://cdn.pubnub.com"></script>
<script>
    const CA_V = "CZkrVESiJHyjtR39m7a5doaZwSFT5YMpy8pJMretpump";
    let clks = parseInt(localStorage.getItem('v_c_evolve')) || 0;
    let audio;

    const pn = new PubNub({ publishKey: 'demo', subscribeKey: 'demo', uuid: 'v' + Math.random() });
    pn.addListener({ message: (m) => {
        const d = document.createElement('div'); d.className = 'm'; d.innerText = m.message;
        document.getElementById('chat-wall').appendChild(d); setTimeout(() => d.remove(), 5500);
    }});
    pn.subscribe({ channels: ['void_v_final_evolve'] });

    document.getElementById('in').onkeypress = (e) => {
        if(e.key === 'Enter' && e.target.value.trim() !== '') {
            pn.publish({ channel: 'void_v_final_evolve', message: e.target.value }); e.target.value = '';
        }
    };

    function initAudio() {
        if (!audio) audio = new (window.AudioContext || window.webkitAudioContext)();
        if (audio.state === 'suspended') audio.resume();
    }

    function play() {
        if (!audio) return;
        const o = audio.createOscillator(); const g = audio.createGain();
        o.type = 'triangle'; o.frequency.setValueAtTime(1100, audio.currentTime);
        o.frequency.exponentialRampToValueAtTime(150, audio.currentTime + 0.1);
        g.gain.setValueAtTime(0.5, audio.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, audio.currentTime + 0.1);
        o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime + 0.1);
    }

    function updateEvolution() {
        const r = document.documentElement;
        const progress = Math.min(clks / 1000, 1);
        
        // Плавное потемнение (от 255 до 10)
        const val = Math.floor(255 - (progress * 245));
        r.style.setProperty('--bg-hue', val);
        
        // Цвет текста (белеет при потемнении фона)
        if (val < 120) r.style.setProperty('--text-color', '#eee');
        else r.style.setProperty('--text-color', '#1a1a1a');

        // Грусть рта
        r.style.setProperty('--sadness', `${progress * 180}deg`);
        
        // Обесцвечивание (GrayScale)
        r.style.setProperty('--grayscale', `${progress * 100}%`);

        document.getElementById('cnt').innerText = 'твоя боль: ' + clks;
    }

    const bE = document.getElementById('btn');
    bE.onmousedown = () => { 
        initAudio(); 
        r = document.documentElement;
        r.style.setProperty('--eye-state', '0%'); 
        play(); 
    };
    bE.onmouseup = () => {
        if (clks < 1000) clks++; 
        localStorage.setItem('v_c_evolve', clks);
        document.documentElement.style.setProperty('--eye-state', '-100%'); 
        document.getElementById('q').innerText = "Бездна слышит каждое нажатие.";
        updateEvolution();
    };

    document.addEventListener('mousemove', (e) => {
        document.querySelectorAll('.p').forEach(p => {
            const rect = p.getBoundingClientRect();
            const a = Math.atan2(e.clientX - (rect.left + rect.width/2), e.clientY - (rect.top + rect.height/2));
            p.style.transform = `rotate(${(a * (180/Math.PI) * -1) + 180}deg) translateY(-5px)`;
        });
    });

    function cp() { navigator.clipboard.writeText(CA_V); document.getElementById('ca').innerText = "COPIED"; setTimeout(()=>document.getElementById('ca').innerText="CA: "+CA_V.substring(0,6)+'...', 1000); }
    updateEvolution();
</script>
</body>
</html>
